<UserControl
    x:Class="WorldBuilder.Views.ProjectSelectionView"
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:lib="clr-namespace:WorldBuilder.Lib"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="clr-namespace:WorldBuilder.ViewModels"
    xmlns:icons="clr-namespace:Material.Icons.Avalonia;assembly=Material.Icons.Avalonia"
    d:DesignHeight="600"
    d:DesignWidth="1000"
    x:CompileBindings="True"
    x:DataType="vm:ProjectSelectionViewModel"
    mc:Ignorable="d">
    <Design.DataContext>
        <vm:ProjectSelectionViewModel />
    </Design.DataContext>
    <Grid Margin="20">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="300" />
            <ColumnDefinition Width="20" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!--  Recent Projects Section  -->
        <Grid Grid.Column="0" Margin="0,0,0,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="20" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <TextBlock Grid.Row="0" FontSize="18">Recent Projects</TextBlock>

            <ScrollViewer Grid.Row="2">
                <ItemsControl ItemsSource="{Binding RecentProjects}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate x:DataType="vm:RecentProject">
                            <Border
                                Margin="0,0,10,15"
                                Background="{DynamicResource SemiColorFill1}"
                                CornerRadius="8"
                                ToolTip.Tip="{Binding TooltipText}">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <!--  Clickable area for opening the project  -->
                                    <Button
                                        Name="ProjectButton"
                                        Grid.Column="0"
                                        Grid.ColumnSpan="2"
                                        Padding="10"
                                        HorizontalAlignment="Stretch"
                                        HorizontalContentAlignment="Stretch"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        Command="{Binding $parent[UserControl].((vm:ProjectSelectionViewModel)DataContext).OpenRecentProjectCommand}"
                                        CommandParameter="{Binding}">
                                        <Button.Styles>
                                            <Style Selector="Button#ProjectButton">
                                                <Setter Property="Cursor" Value="Hand" />
                                            </Style>
                                            <Style Selector="Button#ProjectButton:disabled">
                                                <Setter Property="Cursor" Value="Arrow" />
                                            </Style>
                                            <Style Selector="Button#ProjectButton /template/ ContentPresenter">
                                                <Setter Property="Background" Value="Transparent" />
                                                <Setter Property="Transitions">
                                                    <Transitions>
                                                        <BrushTransition Property="Background" Duration="0:0:0.15" />
                                                    </Transitions>
                                                </Setter>
                                            </Style>
                                            <Style Selector="Button#ProjectButton:pointerover /template/ ContentPresenter">
                                                <Setter Property="Background" Value="{DynamicResource SemiColorFill2}" />
                                            </Style>
                                            <Style Selector="Button#ProjectButton:disabled /template/ ContentPresenter">
                                                <Setter Property="Background" Value="Transparent" />
                                                <Setter Property="Opacity" Value="1" />
                                            </Style>
                                            <Style Selector="Button#ProjectButton:disabled:pointerover /template/ ContentPresenter">
                                                <Setter Property="Background" Value="Transparent" />
                                            </Style>
                                        </Button.Styles>
                                        <StackPanel Margin="0,0,22,0">
                                            <DockPanel LastChildFill="True">
                                                <icons:MaterialIcon Kind="AlertCircle"
                                                                    Width="18"
                                                                    Height="18"
                                                                    Margin="0,0,4,0"
                                                                    VerticalAlignment="Center"
                                                                    DockPanel.Dock="Left"
                                                                    Foreground="{DynamicResource SemiColorDanger}"
                                                                    IsVisible="{Binding HasError}" />
                                                <icons:MaterialIcon Kind="{Binding IconGlyph}"
                                                                    Width="18"
                                                                    Height="18"
                                                                    Margin="0,0,8,0"
                                                                    VerticalAlignment="Center"
                                                                    DockPanel.Dock="Left" />
                                                <TextBlock
                                                    FontSize="16"
                                                    Text="{Binding Name}"
                                                    TextTrimming="CharacterEllipsis"
                                                    VerticalAlignment="Center" />
                                            </DockPanel>
                                            <TextBlock
                                                Margin="0,4,0,0"
                                                FontSize="12"
                                                Foreground="{DynamicResource SemiColorText2}"
                                                Text="{Binding FilePath}"
                                                TextTrimming="CharacterEllipsis" />
                                        </StackPanel>
                                    </Button>

                                    <!--  Dropdown button - renders on top of button  -->
                                    <DropDownButton
                                        Grid.Column="1"
                                        Width="32"
                                        Margin="0,6,6,0"
                                        VerticalAlignment="Top"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        IsHitTestVisible="True"
                                        ToolTip.Tip="Project options">
                                        <DropDownButton.Flyout>
                                            <MenuFlyout>
                                                <MenuItem
                                                    Command="{Binding $parent[UserControl].((vm:ProjectSelectionViewModel)DataContext).OpenRecentProjectCommand}"
                                                    CommandParameter="{Binding}"
                                                    Header="Open" />
                                                <MenuItem
                                                    Command="{Binding $parent[UserControl].((vm:ProjectSelectionViewModel)DataContext).OpenInExplorerCommand}"
                                                    CommandParameter="{Binding}"
                                                    Header="Open in file explorer" />
                                                <MenuItem
                                                    Command="{Binding $parent[UserControl].((vm:ProjectSelectionViewModel)DataContext).RemoveRecentProjectCommand}"
                                                    CommandParameter="{Binding}"
                                                    Header="Remove from recent" />
                                            </MenuFlyout>
                                        </DropDownButton.Flyout>
                                    </DropDownButton>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>

            <!--  Empty State - overlay it on the same row  -->
            <Border
                Grid.Row="2"
                Padding="20"
                Background="{DynamicResource SemiColorFill1}"
                CornerRadius="8"
                IsVisible="{Binding !RecentProjects.Count}">
                <TextBlock
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Text="No recent projects" />
            </Border>
        </Grid>

        <!--  Right Section with App Title and Project Creation  -->
        <StackPanel
            Grid.Column="2"
            VerticalAlignment="Top"
            Spacing="30">

            <!--  App Header  -->
            <StackPanel Spacing="5">
                <StackPanel Orientation="Vertical">
                    <TextBlock FontSize="42" Text="WorldBuilder" />
                    <TextBlock
                        Margin="0,0,0,8"
                        VerticalAlignment="Bottom"
                        FontSize="14"
                        Foreground="{DynamicResource SemiColorText2}"
                        Text="{Binding AppVersion}" />
                </StackPanel>
            </StackPanel>

            <StackPanel Spacing="15">
                <!--  Create New Project  -->
                <Button Command="{Binding NewProjectCommand}" Padding="0" Background="Transparent" BorderThickness="0" HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
                    <Border
                        Padding="20"
                        Background="{DynamicResource SemiColorFill1}"
                        CornerRadius="8"
                        Cursor="Hand"
                        HorizontalAlignment="Stretch">
                        <StackPanel>
                            <TextBlock Text="New Project" />
                            <TextBlock
                                Margin="0,4,0,0"
                                FontSize="12"
                                Foreground="{DynamicResource SemiColorText2}"
                                Text="Create a new blank project." />
                        </StackPanel>
                    </Border>
                </Button>
                <!--  Open Existing Project  -->
                <Button Command="{Binding OpenExistingProjectCommand}" Padding="0" Background="Transparent" BorderThickness="0" HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
                    <Border
                        Padding="20"
                        Background="{DynamicResource SemiColorFill1}"
                        CornerRadius="8"
                        Cursor="Hand"
                        HorizontalAlignment="Stretch">
                        <StackPanel>
                            <TextBlock Text="Open Existing" />
                            <TextBlock
                                Margin="0,4,0,0"
                                FontSize="12"
                                Foreground="{DynamicResource SemiColorText2}"
                                Text="Open an existing project or DAT from the filesystem." />
                        </StackPanel>
                    </Border>
                </Button>
            </StackPanel>
        </StackPanel>
    </Grid>

</UserControl>
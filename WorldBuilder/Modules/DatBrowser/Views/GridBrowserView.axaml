<UserControl xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:WorldBuilder.Modules.DatBrowser.ViewModels"
        xmlns:views="using:WorldBuilder.Views"
        xmlns:sys="using:System"
        mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
        x:Class="WorldBuilder.Modules.DatBrowser.Views.GridBrowserView"
        x:DataType="vm:GridBrowserViewModel">
    <Grid RowDefinitions="Auto, *">
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="10,0,10,0" Spacing="10">
            <TextBlock Text="Items Per Row:" VerticalAlignment="Center"/>
            <Slider Minimum="1" Maximum="36" Value="{Binding ItemsPerRow}" Width="200" VerticalAlignment="Center"/>
            <TextBlock Text="{Binding ItemsPerRow}" VerticalAlignment="Center" Width="30"/>
            <CheckBox Content="Show Wireframe" IsChecked="{Binding ShowWireframe}" IsVisible="{Binding Is3DView}" VerticalAlignment="Center"/>
        </StackPanel>

        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <ItemsRepeater ItemsSource="{Binding FileIds}" Margin="10">
                <ItemsRepeater.Layout>
                    <UniformGridLayout MinItemWidth="{Binding CalculatedItemSize}" 
                                       MinColumnSpacing="10" MinRowSpacing="10" />
                </ItemsRepeater.Layout>
                <ItemsRepeater.ItemTemplate>
                    <DataTemplate x:DataType="sys:UInt32">
                        <Panel>
                            <Button Command="{Binding $parent[UserControl].((vm:GridBrowserViewModel)DataContext).SelectItemCommand}"
                                    CommandParameter="{Binding}"
                                    PointerPressed="OnItemPointerPressed"
                                    HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                                    Background="{Binding $parent[UserControl].((vm:GridBrowserViewModel)DataContext).IsDarkMode, Converter={StaticResource ThemeToViewportBrushConverter}}" Padding="0">
                                <Grid RowDefinitions="*, Auto">
                                    <views:DatObjectPreview 
                                        Grid.Row="0"
                                        DataId="{Binding}"
                                        Dats="{Binding $parent[UserControl].((vm:GridBrowserViewModel)DataContext).Dats}"
                                        IsTooltip="True"
                                        ClearColor="{Binding $parent[UserControl].((vm:GridBrowserViewModel)DataContext).IsDarkMode, Converter={StaticResource ThemeToViewportBrushConverter}}"
                                        ShowWireframe="{Binding $parent[UserControl].((vm:GridBrowserViewModel)DataContext).ShowWireframe}"
                                        WireframeColor="{Binding $parent[UserControl].((vm:GridBrowserViewModel)DataContext).WireframeColor}"
                                        Width="{Binding $parent[UserControl].((vm:GridBrowserViewModel)DataContext).CalculatedItemSize}"
                                        Height="{Binding $parent[UserControl].((vm:GridBrowserViewModel)DataContext).CalculatedItemSize}" />

                                </Grid>
                            </Button>
                            <Button Command="{Binding $parent[UserControl].((vm:GridBrowserViewModel)DataContext).OpenInNewWindowCommand}" 
                                    CommandParameter="{Binding}"
                                    ToolTip.Tip="Open in new window" 
                                    HorizontalAlignment="Right" 
                                    VerticalAlignment="Top"
                                    Margin="5"
                                    Background="{DynamicResource SemiColorFill1}" 
                                    BorderThickness="0">
                                <TextBlock Text="â†—" FontSize="14" FontWeight="Bold" Foreground="{DynamicResource SemiColorPrimary}"/>
                            </Button>
                        </Panel>
                    </DataTemplate>
                </ItemsRepeater.ItemTemplate>
            </ItemsRepeater>
        </ScrollViewer>
    </Grid>
</UserControl>

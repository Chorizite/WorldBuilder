<UserControl
    x:Class="WorldBuilder.Editors.Landscape.Views.LayersView"
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:conv="using:WorldBuilder.Lib.Converters"
    xmlns:vm="using:WorldBuilder.Editors.Landscape.ViewModels"
    x:DataType="vm:LayersViewModel">
    <UserControl.Styles>
        <Style Selector="TreeViewItem" x:DataType="vm:LayerTreeItemViewModel">
            <Setter Property="Padding" Value="4" />
            <Setter Property="Focusable" Value="{Binding IsGroup, Converter={x:Static conv:BoolConverters.Not}}" />
            <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}" />
        </Style>
        <Style Selector="TreeViewItem.base">
            <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundAltMediumBrush}" />
            <Setter Property="FontWeight" Value="Bold" />
        </Style>
        <Style Selector="TreeViewItem:selected">
            <Setter Property="Background" Value="{DynamicResource SystemAccentColor}" />
        </Style>
        <Style Selector="TextBlock.section-header">
            <Setter Property="FontWeight" Value="Bold" />
        </Style>
        <Style Selector="TextBlock.disabled">
            <Setter Property="Opacity" Value="0.3" />
        </Style>
    </UserControl.Styles>
    <DockPanel Height="280" LastChildFill="True">
        <!--  Toolbar  -->
        <StackPanel
            Margin="5"
            HorizontalAlignment="Right"
            DockPanel.Dock="Top"
            Orientation="Horizontal"
            Spacing="5">
            <Button
                Command="{Binding NewLayerCommand}"
                Content="âž•"
                ToolTip.Tip="New Layer" />
            <Button
                Command="{Binding NewGroupCommand}"
                Content="ðŸ“"
                ToolTip.Tip="New Group" />
            <Button
                Command="{Binding DeleteSelectedCommand}"
                Content="ðŸ—‘ï¸"
                IsEnabled="{Binding SelectedItem.IsBase, Converter={x:Static conv:BoolConverters.Not}, FallbackValue=False}"
                ToolTip.Tip="Delete Selected" />
        </StackPanel>
        <!--  Layers Header  -->
        <TextBlock
            Margin="8,8,8,4"
            Classes="section-header"
            DockPanel.Dock="Top"
            Text="Layers" />
        <!--  Layers Tree  -->
        <ScrollViewer>
            <TreeView
                x:Name="LayersTreeView"
                ItemsSource="{Binding Items}"
                SelectedItem="{Binding SelectedItem, Mode=TwoWay}">
                <TreeView.ItemTemplate>
                    <TreeDataTemplate DataType="vm:LayerTreeItemViewModel" ItemsSource="{Binding Children}">
                        <Grid Name="ItemRoot"
                              Background="Transparent"
                              DragDrop.AllowDrop="True"
                              DragDrop.DragOver="TreeViewItemDragOver"
                              DragDrop.DragLeave="TreeViewItemDragLeave"
                              DragDrop.Drop="TreeViewItemDrop"
                              PointerPressed="ItemPointerPressed">

                            <!-- Highlight for dropping "into" a group -->
                            <Border Name="DropIntoIndicator" Background="{DynamicResource SystemAccentColor}"
                                    Opacity="0.3" IsVisible="False" IsHitTestVisible="False" CornerRadius="4" />

                            <StackPanel Orientation="Horizontal" Spacing="5" Background="Transparent">
                                <StackPanel.ContextMenu>
                                    <ContextMenu>
                                        <MenuItem
                                            Command="{Binding Owner.RenameItemCommand}"
                                            CommandParameter="{Binding}"
                                            Header="Rename"
                                            IsEnabled="{Binding IsBase, Converter={x:Static conv:BoolConverters.Not}, FallbackValue=False}" />
                                        <MenuItem
                                            Command="{Binding Owner.DeleteSelectedCommand}"
                                            CommandParameter="{Binding}"
                                            Header="Delete"
                                            IsEnabled="{Binding IsBase, Converter={x:Static conv:BoolConverters.Not}, FallbackValue=False}" />
                                        <MenuItem
                                            Command="{Binding Owner.NewGroupCommand}"
                                            CommandParameter="{Binding}"
                                            Header="Create Group" />
                                    </ContextMenu>
                                </StackPanel.ContextMenu>
                                <!--  Layer/Group/Base Icon  -->
                                <TextBlock
                                    Width="16"
                                    Height="16"
                                    IsVisible="{Binding IsLayer}"
                                    Text="ðŸ“„"
                                    ToolTip.Tip="Layer" />
                                <TextBlock
                                    Width="16"
                                    Height="16"
                                    IsVisible="{Binding IsGroup}"
                                    Text="ðŸ“"
                                    ToolTip.Tip="Group" />
                                <TextBlock
                                    Width="16"
                                    Height="16"
                                    IsVisible="{Binding IsBase}"
                                    Text="ðŸ”’"
                                    ToolTip.Tip="Base Layer" />
                                <!--  Layer Name  -->
                                <TextBlock VerticalAlignment="Center" Text="{Binding Name}" />
                                <!--  Visibility Toggle  -->
                                <Button
                                    Command="{Binding Owner.ToggleVisibilityCommand}"
                                    CommandParameter="{Binding}"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Padding="2"
                                    IsEnabled="{Binding !IsBase}"
                                    IsVisible="{Binding IsVisible}"
                                    Content="ðŸ‘ï¸"
                                    ToolTip.Tip="Toggle Visibility" />
                                <Button
                                    Command="{Binding Owner.ToggleVisibilityCommand}"
                                    CommandParameter="{Binding}"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Padding="2"
                                    IsEnabled="{Binding !IsBase}"
                                    IsVisible="{Binding !IsVisible}"
                                    Content="ðŸ™ˆ"
                                    ToolTip.Tip="Toggle Visibility" />

                                <!--  Export Toggle  -->
                                <Button
                                    Command="{Binding Owner.ToggleExportCommand}"
                                    CommandParameter="{Binding}"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Padding="2"
                                    IsEnabled="{Binding !IsBase}"
                                    IsVisible="{Binding IsExport}"
                                    Content="ðŸ“¤"
                                    ToolTip.Tip="Toggle Export" />
                                <Button
                                    Command="{Binding Owner.ToggleExportCommand}"
                                    CommandParameter="{Binding}"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Padding="2"
                                    IsEnabled="{Binding !IsBase}"
                                    IsVisible="{Binding !IsExport}"
                                    Content="ðŸš«"
                                    ToolTip.Tip="Toggle Export" />
                            </StackPanel>

                            <!-- Drop Before Indicator -->
                            <Border Name="DropBeforeIndicator" VerticalAlignment="Top" Height="2"
                                    Background="{DynamicResource SystemAccentColor}" IsVisible="False"
                                    IsHitTestVisible="False" />

                            <!-- Drop After Indicator -->
                            <Border Name="DropAfterIndicator" VerticalAlignment="Bottom" Height="2"
                                    Background="{DynamicResource SystemAccentColor}" IsVisible="False"
                                    IsHitTestVisible="False" />
                        </Grid>
                    </TreeDataTemplate>
                </TreeView.ItemTemplate>
            </TreeView>
        </ScrollViewer>

    </DockPanel>
</UserControl>